(function(a){a.fn.extend({BlackAndWhite:function(b){var g=this;b=a.extend({hoverEffect:!0,webworkerPath:!1,responsive:!0,invertHoverEffect:!1,speed:500},b);var n=b.hoverEffect,h=b.webworkerPath,f=b.invertHoverEffect,q=b.responsive,k=a.isPlainObject(b.speed)?b.speed.fadeIn:b.speed,l=a.isPlainObject(b.speed)?b.speed.fadeOut:b.speed,r=!!document.createElement("canvas").getContext,s=a(window),t="undefined"!==typeof Worker?!0:!1,u=a.browser.msie&&7===+a.browser.version,v=function(a,c,e,d){var b=c.getContext("2d");
    c=0;b.drawImage(a,0,0,e,d);a=b.getImageData(0,0,e,d);d=a.data;var f=d.length;if(t&&h)c=new Worker(h+"BnWWorker.js"),c.postMessage(a),c.onmessage=function(a){b.putImageData(a.data,0,0)};else{for(;c<f;c+=4)e=0.3*d[c]+0.59*d[c+1]+0.11*d[c+2],d[c]=d[c+1]=d[c+2]=e;b.putImageData(a,0,0)}},p=function(b,c){var e=b.src;if(!r||a.browser.msie&&"9.0"==a.browser.version){var d=a(c).find("img").prop("width"),m=a(c).find("img").prop("height");a("<img src="+e+' width="'+d+'" height="'+m+'" class="ieFix" /> ').prependTo(c);
    a(".ieFix").css({position:"absolute",top:0,left:0,filter:"progid:DXImageTransform.Microsoft.BasicImage(grayscale=1)",display:f?"none":"block"});n&&(a(c).mouseenter(function(){f?a(this).children(".ieFix").stop(!0,!0).fadeIn(k):a(this).children(".ieFix").stop(!0,!0).fadeOut(l)}),a(c).mouseleave(function(){f?a(this).children(".ieFix").stop(!0,!0).fadeOut(l):a(this).children(".ieFix").stop(!0,!0).fadeIn(k)}))}else{var e=a(c).find("img").width(),d=a(c).find("img").height(),m=b.width,g=b.height;a('<canvas width="'+
    m+'" height="'+g+'"></canvas>').prependTo(c);var h=a(c).find("canvas");a(h).css({position:"absolute",top:0,left:0,width:e,height:d,display:f?"none":"block"});v(b,h[0],m,g);n&&(a(c).mouseenter(function(){f?a(this).find("canvas").stop(!0,!0).fadeIn(k):a(this).find("canvas").stop(!0,!0).fadeOut(l)}),a(c).mouseleave(function(){f?a(this).find("canvas").stop(!0,!0).fadeOut(l):a(this).find("canvas").stop(!0,!0).fadeIn(k)}))}};this.init=function(b){if(a.browser.msie)return!1;a(g).each(function(c,b){var d=
    new Image;d.src=a(b).find("img").prop("src");if(d.width)p(d,b);else a(d).on("load",function(){p(d,b)})});if(q)s.on("resize orientationchange",g.resizeImages)};this.resizeImages=function(){a(g).each(function(b,c){var e=a(c).find("img:not(.ieFix)"),d;u?(d=a(e).prop("width"),e=a(e).prop("height")):(d=a(e).width(),e=a(e).height());a(this).find(".ieFix, canvas").css({width:d,height:e})})};return this.init(b)}})})(jQuery);